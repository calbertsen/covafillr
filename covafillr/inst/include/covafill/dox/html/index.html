<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>covafill: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">covafill
   &#160;<span id="projectnumber">v0.2.3</span>
   </div>
   <div id="projectbrief">Local Polynomial Regression of State Dependent Covariates in State-Space Models</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">covafill Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>covafill is a C++ template library for local polynomial regression of covariates in state-space models. The covafill library is based on the <a href="http://http://eigen.tuxfamily.org">Eigen</a> library for linear algebra, and includes several modules:</p>
<ul>
<li>The <a class="el" href="group__core.html">Core module</a> which provides the base functionality for local polynomial regression</li>
<li>The <a class="el" href="group__tree.html">Tree module</a> which provides a search tree approximation to local polynomial regression</li>
<li>The <a class="el" href="group__interpolate.html">Interpolate module</a> which provides classes for cubic interpolation in 1-3 dimensions. This module is only inteded for internal use.</li>
<li>The <a class="el" href="group__jags.html">JAGS module</a>, which provides a module for using covafill with <a href="http://mcmc-jags.sourceforge.net/">JAGS</a></li>
<li>The <a class="el" href="group__tmb.html">TMB module</a> which provides functionality to use covafill with <a href="http://tmb-project.org">TMB</a>.</li>
</ul>
<h2>The Core module</h2>
<p>The Core module provides the class <a class="el" href="classcovafill.html">covafill</a> for local polynomial regression.</p>
<h3>Local polynomial regression</h3>
<p>For simplicity, consider the univariate model</p>
<p class="formulaDsp">
\[ y_i = g(x_i) + \epsilon_i \]
</p>
<p>where \(g:\mathbb{R}\mapsto\mathbb{R}\) is a smooth function and \( \epsilon_i\sim N(0,\sigma^2)\). To do local polynomial regression of \(g\) at \(x_0\), we do a Taylor expansion of order \(p\),</p>
<p class="formulaDsp">
\[ g(x) \approx g(x_0) + g^{(1)}(x_0)(x-x_0) + \frac{1}{2!} g^{(2)}(x_0)(x-x_0)^2 + \cdots + \frac{1}{p!} g^{(p)}(x_0)(x-x_0)^p \]
</p>
<p> Substituting into the original model, </p><p class="formulaDsp">
\[ y_i = g(x_0) + g^{(1)}(x_0)(x-x_0) + \frac{1}{2!} g^{(2)}(x_0)(x-x_0)^2 + \cdots + \frac{1}{p!} g^{(p)}(x_0)(x-x_0)^p + \epsilon_i \]
</p>
<p> we obtain a linear model with coefficients \( \mathbf{\theta} = (g(x_0), g^{(1)}(x_0), g^{(2)}(x_0), \ldots, g^{(p)}(x_0))^T \), obervations \( \mathbf{Y} = (y_1, y_2, \ldots, y_n)^T \), and the design matrix </p><p class="formulaDsp">
\[ \mathbf{X} = \left(\begin{array}{ccccc} 1 &amp; (x_1-x_0) &amp; \frac{1}{2!} (x_1-x_0)^2 &amp; \cdots &amp; \frac{1}{p!} (x_1-x_0)^p \\ 1 &amp; (x_2-x_0) &amp; \frac{1}{2!} (x_2-x_0)^2 &amp; \cdots &amp; \frac{1}{p!} (x_2-x_0)^p \\ \vdots &amp; \vdots &amp; \vdots &amp; &amp; \vdots \\ 1 &amp; (x_n-x_0) &amp; \frac{1}{2!} (x_n-x_0)^2 &amp; \cdots &amp; \frac{1}{p!} (x_n-x_0)^p \end{array}\right) \]
</p>
<p> As we are interested in a local estimate, observations are weighed by their distance to \(x_0\). The weights form the diagonal matrix \(\mathbf{W}\) with </p><p class="formulaDsp">
\[ w_{ii} = \det(H^{-1}) \left(1 - \| H^{-1} \cdot ( x_i - x_0) \| ^ 2 \right) \vee 0 \]
</p>
<p>Now the estimates are obtained by </p><p class="formulaDsp">
\[ \hat{\mathbf{\theta}} = (\mathbf{X}^T\mathbf{W}\mathbf{X})^{-1} \mathbf{X}^T\mathbf{W}\mathbf{Y} \]
</p>
<p> giving both the estimated function value at \( x_0 \) and estimates of the first \( p \) derivatives.</p>
<p>A covariance matrix for the estimates can be calculated by</p>
<p class="formulaDsp">
\[ V(\hat{\mathbf{\theta}}) = (\mathbf{X}^T\mathbf{W}\mathbf{X})^{-1} (\mathbf{R}^T \mathbf{W} \mathbf{R}) (N-q)^{-1} \]
</p>
<p>where \( N \) is the number of observations with non-negative weights, \( q \) is the number of regressors, and</p>
<p class="formulaDsp">
\[ \mathbf{R} = \mathbf{Y}-\mathbf{X}\hat{\mathbf{\theta}} \]
</p>
<p>Note that it is not necessary to have a properly normalized kernel function as the normalizing constant vanishes in the calculation of both the estimates and covariance matrix.</p>
<h2>The Tree module</h2>
<p>The Tree module contains the covatree class for a search tree approximation to local polynomial regression. The covatree class builds a simple search tree by splitting the data in the coordinate with the highest variance. The split is performed at the mean of the coordinates. At terminal notes, the class does local polynomial regression at the corners of the bounding box of the coordinates related to the note and calculates the necessary coefficients to do cubic interpolation between the corners.</p>
<h2>The JAGS and TMB modules</h2>
<p>The JAGS and TMB modules provide functionality to use covafill within these tools. The JAGS module provides a JAGS Module including a function, covafill, to call in a JAGS model (See example below). The TMB module include functions to evaluate a covafill or covatree object from a TMB model such that the estimated derivatives are used in the automatic differentiation (See example below).</p>
<h3>JAGS example</h3>
<div class="fragment"><div class="line">model {</div>
<div class="line">      cf &lt;- <a class="code" href="classcovafill.html">covafill</a>(x,obsC,obs,h,2.0)</div>
<div class="line">      sigma ~ dunif(0,100)</div>
<div class="line">      tau &lt;- pow(sigma, -2)</div>
<div class="line">      for(i in 1:N) {</div>
<div class="line">            y[i] ~ dnorm(cf[i],tau)</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment --><h3>TMB example</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;TMB.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;covafill/TMB&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Type&gt;</div>
<div class="line">Type objective_function&lt;Type&gt;::operator() ()</div>
<div class="line">{</div>
<div class="line">  DATA_MATRIX(obs);</div>
<div class="line">  DATA_MATRIX(coord);</div>
<div class="line">  DATA_VECTOR(covObs);</div>
<div class="line">  DATA_INTEGER(p);</div>
<div class="line">  DATA_VECTOR(h);</div>
<div class="line"></div>
<div class="line">  PARAMETER(logObsSd);</div>
<div class="line">  PARAMETER(logObsTSd);</div>
<div class="line">  PARAMETER(logStatSd);</div>
<div class="line">  PARAMETER_MATRIX(x);</div>
<div class="line"></div>
<div class="line">  Type nll = 0.0;</div>
<div class="line">  <a class="code" href="classcovafill.html">covafill&lt;Type&gt;</a> cf(coord,covObs,h,p);</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Contribution from states</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt; x.cols(); ++i){</div>
<div class="line">    nll -= dnorm(x(0,i), x(0,i-1), exp(logStatSd),<span class="keyword">true</span>);</div>
<div class="line">    nll -= dnorm(x(1,i), x(1,i-1), exp(logStatSd),<span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">  <span class="comment">// contribution from observations</span></div>
<div class="line">  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; obs.cols(); ++i){</div>
<div class="line">    nll -= dnorm(obs(0,i), x(0,i), exp(logObsSd),<span class="keyword">true</span>);</div>
<div class="line">    nll -= dnorm(obs(1,i), x(1,i), exp(logObsSd),<span class="keyword">true</span>);</div>
<div class="line">    vector&lt;Type&gt; tmp = x.col(i);</div>
<div class="line">    Type val = <a class="code" href="group__tmb.html#ga0862de227e5abdeba2394525467bafe4">evalFill</a>((CppAD::vector&lt;Type&gt;)tmp, cf)[0];</div>
<div class="line">    nll -= dnorm(obs(2,i), val, exp(logObsTSd),<span class="keyword">true</span>);</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">  <span class="keywordflow">return</span> nll;</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.9.1
</small></address>
</body>
</html>
